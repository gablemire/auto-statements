functions:
  paypalIpn:
    handler: paypalIpn
    events:
      - http: http

  createCheque:
    handler: createCheque
    events:
      - http: http

  listDonations:
    handler: listDonations
    events:
      - http: http

  getDonation:
    handler: getDonation
    events:
      - http: http

  generatePdfReceipt:
    handler: generatePdfReceipt
    events:
      - http: http

  launchBulkImport:
    handler: launchBulkImport
    events:
      - http: http

  patchDonation:
    handler: patchDonation
    events:
      - http: http

  sendCorrespondence:
    handler: sendCorrespondence
    events:
      - http: http

  pdf:
    handler: pdf
    memorySize: 1024
    environment:
      NODE_ICU_DATA: 'node_modules/full-icu'
    timeout: 120s
    events:
      - event:
          eventType: providers/cloud.pubsub/eventTypes/topic.publish
          resource: 'projects/${self:provider.project, ""}/topics/pdf-generation'

  bulkImport:
    handler: bulkImport
    memorySize: 1024
    events:
      - event:
          eventType: providers/cloud.pubsub/eventTypes/topic.publish
          resource: 'projects/${self:provider.project, ""}/topics/bulk-import'

  email:
    handler: email
    environment:
      # We need to load the secret file dynamically
      SENDGRID_API_KEY: ${file(./.gcloud/secrets.staging.yml):sendGrid.apiKey}
      EMAIL_FROM: ${file(./.gcloud/secrets.staging.yml):sendGrid.from}
      EMAIL_REPLY_TO: ${file(./.gcloud/secrets.staging.yml):sendGrid.replyTo}
    events:
      - event:
          eventType: providers/cloud.pubsub/eventTypes/topic.publish
          resource: 'projects/${self:provider.project, ""}/topics/send-email'
